<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PizzUM & BurgUM — Pedido</title>

  <!-- Hojas de estilo globales -->
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/components.css}">
  <link rel="stylesheet" th:href="@{/css/pages.css}">
</head>
<body class="theme-italian">
  
<!-- Header global -->
<header class="site-header">
  <div class="container header__inner">
    <a class="brand" th:href="@{/}">
      <img th:src="@{/img/logo.png}" alt="PizzUM &amp; BurgUM" class="brand__logo">
      <span class="brand__name">PizzUM &amp; BurgUM</span>
    </a>
    <nav class="site-nav">
      <a class="nav__link"
         th:classappend="${page == 'pizza'} ? ' is-active'"
         th:href="@{/crear-pizza}">
         Crear pizza
      </a>
      <a class="nav__link"
         th:classappend="${page == 'burger'} ? ' is-active'"
         th:href="@{/crear-burger}">
         Crear hamburguesa
      </a>
      <a class="nav__link"
         th:classappend="${page == 'favoritos'} ? ' is-active'"
         th:href="@{/favoritos}">
         ❤️ Favoritos
      </a>
      <a class="nav__link"
         th:classappend="${page == 'carrito'} ? ' is-active'"
         th:href="@{/carrito}">
         Carrito
      </a>
      <a class="nav__link"
         th:classappend="${page == 'pedido'} ? ' is-active'"
         th:href="@{/pedido}">
         Pedidos
      </a>
    </nav>
  </div>
</header>


  <main>
    <!-- Encabezado de confirmación -->
    <section class="container section">
      <div class="order-confirm">
        <div class="order-confirm__icon">
          <img th:src="@{/img/check-order.svg}" alt="" aria-hidden="true">
        </div>
        <div class="order-confirm__content">
          <h1>¡Pedido confirmado!</h1>
          <p>Nº de pedido: <strong th:text="'#' + ${pedido.id}">#000000</strong></p>
          <p>Fecha: <strong th:text="${#temporals.format(pedido.date, 'dd/MM/yyyy HH:mm')}">—:—</strong></p>
          <div class="order-confirm__actions">
            <a class="btn btn--primary" th:href="@{/}">Seguir comprando</a>
            <a class="btn btn--secondary" href="#seguimiento">Ver seguimiento</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Seguimiento del pedido -->
    <section id="seguimiento" class="container section">
      <h2>Seguimiento del pedido</h2>

      <!-- Timeline de estados -->
      <ol class="timeline" aria-label="Estados del pedido">
        <li class="timeline__step" th:classappend="${enCola ? 'is-current' : ''}">
          <div class="timeline__marker"></div>
          <div class="timeline__content">
            <h3>En cola</h3>
            <p>Tu pedido está en la cola de la cocina.</p>
            <!-- Cancelar solo en este estado -->
            <form th:if="${enCola}" class="inline-form" method="post" th:action="@{/pedido/{id}/cancelar(id=${pedido.id})}">
              <button class="btn btn--danger" type="submit">Cancelar pedido</button>
            </form>
          </div>
        </li>
        <li class="timeline__step" th:classappend="${enPreparacion ? 'is-current' : ''}">
          <div class="timeline__marker"></div>
          <div class="timeline__content">
            <h3>En preparación</h3>
            <p>Estamos preparando tus productos.</p>
          </div>
        </li>
        <li class="timeline__step" th:classappend="${enCamino ? 'is-current' : ''}">
          <div class="timeline__marker"></div>
          <div class="timeline__content">
            <h3>En camino</h3>
            <p>El repartidor ya salió hacia tu domicilio.</p>
          </div>
        </li>
        <li class="timeline__step" th:classappend="${entregado ? 'is-current' : ''}">
          <div class="timeline__marker"></div>
          <div class="timeline__content">
            <h3>Entregado</h3>
            <p>¡Buen provecho!</p>
          </div>
        </li>
      </ol>
    </section>

    <!-- Resumen del pedido -->
    <section class="container section section--grid-2">
      <article class="order-card">
        <h2 class="order-card__title">Detalle del pedido</h2>
        <ul class="order-items">
          <!-- Pizzas -->
          <li class="order-item" th:each="pizza : ${pedido.pizzas}">
            <img class="order-item__img" th:src="@{/img/pizza-thumb.png}" alt="Pizza">
            <div class="order-item__info">
              <p class="order-item__name">Pizza personalizada</p>
              <p class="order-item__meta" th:text="${pizza.tamanio + ' • ' + pizza.tipo_masa + ' • ' + pizza.tipo_salsa + ' • ' + pizza.tipo_queso}">Detalles</p>
            </div>
            <div class="order-item__qty">x1</div>
            <div class="order-item__price" th:text="'$' + ${pizza.precio}">$ 0</div>
          </li>
          
          <!-- Hamburguesas -->
          <li class="order-item" th:each="hamburguesa : ${pedido.hamburguesas}">
            <img class="order-item__img" th:src="@{/img/burger-thumb.png}" alt="Hamburguesa">
            <div class="order-item__info">
              <p class="order-item__name">Hamburguesa personalizada</p>
              <p class="order-item__meta" th:text="${hamburguesa.cant_de_carnes + ' carnes'}">Detalles</p>
            </div>
            <div class="order-item__qty">x1</div>
            <div class="order-item__price" th:text="'$' + ${hamburguesa.precio_base}">$ 0</div>
          </li>
        </ul>

        <dl class="totals">
          <div class="totals__row"><dt>Subtotal</dt><dd th:text="'$' + ${pedido.totalCost}">$ 0</dd></div>
          <div class="totals__row"><dt>Envío</dt><dd>$ 0</dd></div>
          <div class="totals__row totals__row--total"><dt>Total</dt><dd th:text="'$' + ${pedido.totalCost}">$ 0</dd></div>
        </dl>
      </article>

      <!-- Datos de entrega y pago -->
      <aside class="order-aside">
        <h2 class="order-aside__title">Entrega</h2>
        <p class="order-aside__text">
          <strong>Domicilio:</strong> <span th:text="${pedido.direccion.direccion}">Dirección</span><br>
          <strong th:if="${pedido.direccion.indicaciones}">Indicaciones:</strong> 
          <span th:if="${pedido.direccion.indicaciones}" th:text="${pedido.direccion.indicaciones}">Indicaciones</span>
        </p>

        <h2 class="order-aside__title">Pago</h2>
        <p class="order-aside__text">
          Tarjeta terminada en <strong th:text="'•••• ' + ${#strings.substring(pedido.medioDePago.cardNumber.toString(), pedido.medioDePago.cardNumber.toString().length() - 4)}">1234</strong><br>
          Titular: <strong th:text="${pedido.medioDePago.firstNameOnCard + ' ' + pedido.medioDePago.lastNameOnCard}">Nombre</strong>
        </p>

        <h2 class="order-aside__title">Contacto</h2>
        <p class="order-aside__text">
          <strong>Tel:</strong> <span th:text="${cliente.phoneNumber}">099 000 000</span><br>
          <strong>Email:</strong> <span th:text="${cliente.email}">email</span>
        </p>
      </aside>
    </section>

    <!-- Acciones finales -->
    <section class="container section">
      <div class="final-actions">
        <a class="btn btn--primary" th:href="@{/}">Volver al inicio</a>
        <a class="btn btn--ghost" th:href="@{/pedido/{id}(id=${pedido.id})}">Actualizar estado</a>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer__inner">
      <small>&copy; 2025 PizzUM &amp; BurgUM</small>
      <nav class="footer-nav">
        <a th:href="@{#}" class="footer__link">Ayuda</a>
        <a th:href="@{#}" class="footer__link">Términos</a>
        <a th:href="@{#}" class="footer__link">Privacidad</a>
      </nav>
    </div>
  </footer>
</body>
</html>
