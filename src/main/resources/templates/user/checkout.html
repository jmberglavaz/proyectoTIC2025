<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PizzUM &amp; BurgUM ‚Äî Checkout</title>

    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/pages.css}">
</head>
<body class="theme-italian">

<header class="site-header">
    <div class="container header__inner">
        <a class="brand" th:href="@{/}">
            <img th:src="@{/img/logo.png}" alt="PizzUM &amp; BurgUM" class="brand__logo">
            <span class="brand__name">PizzUM &amp; BurgUM</span>
        </a>
        <nav class="site-nav">
            <a class="nav__link" th:href="@{/crear-pizza}">Crear pizza</a>
            <a class="nav__link" th:href="@{/crear-burger}">Crear hamburguesa</a>
            <a class="nav__link" th:href="@{/carrito}">Carrito</a>
            <a class="nav__link is-active" th:href="@{/checkout}">Checkout</a>
        </nav>
    </div>
</header>

<main>

    <!-- Pasos -->
    <section class="container section">
        <ol class="stepper">
            <li class="stepper__item"><a th:href="@{/carrito}">Carrito</a></li>
            <li class="stepper__item is-current">Checkout</li>
            <li class="stepper__item">Confirmaci√≥n</li>
        </ol>
    </section>

    <section class="container section section--grid-2">

        <!-- ========================================================= -->
        <!-- FORMULARIO PRINCIPAL -->
        <!-- ========================================================= -->

        <form class="form form--checkout" method="post" th:action="@{/checkout}">

            <!-- -------- CUENTA -------- -->
            <fieldset class="form-section">
                <legend class="form-section__title">Tu cuenta</legend>

                <div class="card card--muted">
                    <dl class="totals" style="padding:0;border:none">
                        <div class="totals__row">
                            <dt>Nombre</dt>
                            <dd th:text="${cliente != null ? cliente.firstName + ' ' + cliente.lastName : '‚Äî'}">
                                Nombre
                            </dd>
                        </div>
                        <div class="totals__row">
                            <dt>Email</dt>
                            <dd th:text="${cliente != null ? cliente.email : '‚Äî'}">
                                cliente@correo.com
                            </dd>
                        </div>
                        <div class="totals__row">
                            <dt>Tel√©fono</dt>
                            <dd th:text="${cliente != null ? cliente.phoneNumber : '‚Äî'}">
                                099 000 000
                            </dd>
                        </div>
                    </dl>
                    <small>Estos datos vienen de tu perfil.</small>
                </div>
            </fieldset>

            <!-- -------- DIRECCIONES -------- -->
            <fieldset class="form-section">
                <legend class="form-section__title">Direcci√≥n de entrega</legend>
                <p class="form-hint">Eleg√≠ una de tus direcciones guardadas o agreg√° una nueva.</p>

                <div class="select-list" role="radiogroup" aria-label="Direcciones guardadas">
                    <label class="option select-card"
                           th:each="dir,idx : ${direcciones}">
                        <input type="radio"
                               name="direccion_id"
                               th:value="${dir.id}"
                               th:checked="${idx.index == 0}">
                        <div class="select-card__body">
                            <div class="select-card__title">
                                <strong th:text="${dir.address}">Direcci√≥n</strong>
                            </div>
                            <div class="select-card__meta">
                                <small th:text="${dir.indications != null ? dir.indications : ''}">Indicaciones</small>
                            </div>
                        </div>
                    </label>

                    <!-- Si no hay direcciones -->
                    <p class="form-hint" th:if="${#lists.isEmpty(direcciones)}">
                        A√∫n no ten√©s direcciones cargadas. Agreg√° una debajo.
                    </p>
                </div>

                <!-- Bot√≥n para agregar nueva direcci√≥n que redirige al perfil -->
                <div class="form-actions" style="justify-content:flex-start; margin-top:var(--space-3)">
                    <a class="btn btn--secondary" th:href="@{/perfil}">
                        ‚ûï Agregar nueva direcci√≥n
                    </a>
                </div>
            </fieldset>

            <!-- -------- TARJETAS -------- -->
            <fieldset class="form-section">
                <legend class="form-section__title">Pago con tarjeta</legend>
                <p class="form-hint">Seleccion√° una tarjeta guardada e ingres√° el CVV.</p>

                <div class="select-list" role="radiogroup" aria-label="Tarjetas guardadas">
                    <label class="option select-card"
                           th:each="t,idx : ${mediosDePago}">

                        <input type="radio"
                               name="tarjeta_id"
                               th:value="${t.cardNumber}"
                               th:checked="${idx.index == 0}">
                        <div class="select-card__body">
                            <div class="select-card__title">
                                <strong th:text="${'‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ' + (t.cardNumber % 10000)}">
                                    ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1234
                                </strong>
                            </div>
                            <div class="select-card__meta">
                                <small th:text="${'Titular: ' + t.firstNameOnCard + ' ' + t.lastNameOnCard}">
                                    Titular
                                </small>
                            </div>
                        </div>
                    </label>

                    <p class="form-hint" th:if="${#lists.isEmpty(mediosDePago)}">
                        A√∫n no ten√©s tarjetas guardadas. Pod√©s agregar una debajo.
                    </p>
                </div>

                <!-- CVV de la tarjeta seleccionada -->
                <div class="form-group" style="max-width:220px; margin-top:var(--space-3);">
                    <label for="cvv_seleccionada">CVV</label>
                    <input class="input"
                           id="cvv_seleccionada"
                           name="cvv_seleccionada"
                           type="text"
                           inputmode="numeric"
                           pattern="[0-9]{3}"
                           placeholder="3 d√≠gitos"
                           required>
                </div>

                <!-- Bot√≥n para agregar nueva tarjeta que redirige al perfil -->
                <div class="form-actions" style="justify-content:flex-start; margin-top:var(--space-3)">
                    <a class="btn btn--secondary" th:href="@{/perfil}">
                        üí≥ Agregar nueva tarjeta
                    </a>
                </div>
            </fieldset>

            <!-- -------- ACCIONES -------- -->
            <div class="form-actions">
                <a class="btn btn--secondary" th:href="@{/carrito}">Volver al carrito</a>
                <button class="btn btn--primary"
                        type="submit"
                        name="accion"
                        value="confirmar_pedido">
                    Confirmar pedido
                </button>
            </div>
        </form>

        <!-- ========================================================= -->
        <!-- RESUMEN DEL PEDIDO (items del carrito EN MEMORIA) -->
        <!-- ========================================================= -->

        <aside class="checkout-summary" aria-label="Resumen del pedido">
            <h2 class="checkout-summary__title">Resumen del pedido</h2>

            <ul class="checkout-items">
                <li class="checkout-item" th:each="item : ${items}">
                    <img class="checkout-item__img"
                         th:src="${item.tipo == 'pizza'} ? '/img/pizza-thumb.png' : '/img/burger-thumb.png'"
                         th:alt="${item.titulo}">
                    <div class="checkout-item__info">
                        <p class="checkout-item__name" th:text="${item.titulo}">Producto</p>
                        <p class="checkout-item__meta" th:text="${item.descripcion}">Descripci√≥n</p>
                    </div>
                    <div class="checkout-item__qty"
                         th:text="${'x' + item.cantidad}">
                        x1
                    </div>
                    <div class="checkout-item__price"
                         th:text="${'$ ' + #numbers.formatDecimal(item.subtotal,1,2)}">
                        $ 0
                    </div>
                </li>
            </ul>

            <dl class="totals">
                <div class="totals__row">
                    <dt>Subtotal</dt>
                    <dd th:text="${'$ ' + #numbers.formatDecimal(subtotal,1,2)}">$ 0</dd>
                </div>
                <div class="totals__row">
                    <dt>Env√≠o</dt>
                    <dd th:text="${'$ ' + #numbers.formatDecimal(envio,1,2)}">$ 0</dd>
                </div>
                <div class="totals__row totals__row--total">
                    <dt>Total</dt>
                    <dd th:text="${'$ ' + #numbers.formatDecimal(total,1,2)}">$ 0</dd>
                </div>
            </dl>
        </aside>

    </section>

</main>

<footer class="site-footer">
    <div class="container footer__inner">
        <small>&copy; 2025 PizzUM &amp; BurgUM</small>
    </div>
</footer>

</body>
</html>