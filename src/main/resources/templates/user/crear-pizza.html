<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PizzUM &amp; BurgUM ‚Äî Crear pizza</title>

    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/pages.css}">
</head>
<body class="theme-italian">

<header class="site-header">
    <div class="container header__inner">
        <a class="brand" th:href="@{/}">
            <img th:src="@{/img/logo.png}" alt="PizzUM &amp; BurgUM" class="brand__logo">
            <span class="brand__name">PizzUM &amp; BurgUM</span>
        </a>
        <nav class="site-nav">
            <a class="nav__link"
               th:classappend="${page == 'pizza'} ? ' is-active'"
               th:href="@{/crear-pizza}">
                Crear pizza
            </a>
            <a class="nav__link"
               th:classappend="${page == 'burger'} ? ' is-active'"
               th:href="@{/crear-burger}">
                Crear hamburguesa
            </a>
            <a class="nav__link"
               th:classappend="${page == 'favoritos'} ? ' is-active'"
               th:href="@{/favoritos}">
                ‚ù§Ô∏è Favoritos
            </a>
            <a class="nav__link"
               th:classappend="${page == 'carrito'} ? ' is-active'"
               th:href="@{/carrito}">
                Carrito
            </a>
            <a class="nav__link"
               th:classappend="${page == 'pedido'} ? ' is-active'"
               th:href="@{/pedido}">
                Pedidos
            </a>
        </nav>
    </div>
    <div th:if="${clienteNombre}" class="user-info">
        Hola, <span th:text="${clienteNombre}"></span>!
    </div>
</header>

<main>
    <section class="page-hero">
        <div class="container page-hero__inner">
            <div class="page-hero__media">
                <img th:src="@{/img/custom-pizza.png}" alt="Ingredientes frescos para tu pizza" class="page-hero__img">
            </div>
            <div class="page-hero__content">
                <h1>Cre√° tu pizza üçï</h1>
                <p>Eleg√≠ tama√±o, masa, salsa, queso y toppings. Despu√©s agregala al carrito.</p>
            </div>
        </div>
    </section>

    <section class="container section">
        <form id="favForm" th:action="@{/favoritos/agregar}" method="post" style="display:none;">
            <input type="hidden" name="tipo" value="pizza">
        </form>

        <form class="form form--builder" method="post" th:action="@{/crear-pizza}">

            <!-- TAMA√ëOS FIJOS -->
            <fieldset class="form-section">
                <legend class="form-section__title">Tama√±o</legend>
                <div class="options options--inline">
                    <label class="option">
                        <input type="radio" name="tamanio" id="tamanio-s" value="S"
                               required
                               th:checked="${tamanioSeleccionado} == 'S'">
                        <span class="option__label">Peque√±a (S) <small class="option__price">$ 320</small></span>
                    </label>
                    <label class="option">
                        <input type="radio" name="tamanio" id="tamanio-m" value="M"
                               th:checked="${tamanioSeleccionado} == 'M'">
                        <span class="option__label">Mediana (M) <small class="option__price">$ 420</small></span>
                    </label>
                    <label class="option">
                        <input type="radio" name="tamanio" id="tamanio-l" value="L"
                               th:checked="${tamanioSeleccionado} == 'L'">
                        <span class="option__label">Grande (L) <small class="option__price">$ 520</small></span>
                    </label>
                </div>
            </fieldset>

            <!-- MASAS DESDE BD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Tipo de masa</legend>
                <div class="options options--inline">
                    <label class="option" th:each="masa : ${masas}">
                        <input type="radio" name="masa" th:value="${masa.idTopping}"
                               required
                               th:checked="${masaSeleccionada} == ${masa.idTopping}">
                        <span class="option__label">
                            <span th:text="${masa.nombre}">Masa</span>
                            <small class="option__price"
                                   th:text="${masa.precioTopping} == 0 ? 'incluido' : '$ ' + ${#numbers.formatDecimal(masa.precioTopping, 1, 2)}">
                                precio
                            </small>
                        </span>
                    </label>
                </div>
            </fieldset>

            <!-- SALSAS DESDE BD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Salsa</legend>
                <div class="options options--inline">
                    <label class="option" th:each="salsa : ${salsas}">
                        <input type="radio" name="salsa" th:value="${salsa.idTopping}"
                               required
                               th:checked="${salsaSeleccionada} == ${salsa.idTopping}">
                        <span class="option__label">
                            <span th:text="${salsa.nombre}">Salsa</span>
                            <small class="option__price"
                                   th:text="${salsa.precioTopping} == 0 ? 'incluido' : '$ ' + ${#numbers.formatDecimal(salsa.precioTopping, 1, 2)}">
                                precio
                            </small>
                        </span>
                    </label>
                </div>
            </fieldset>

            <!-- QUESOS DESDE BD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Queso</legend>
                <div class="options options--inline">
                    <label class="option" th:each="queso : ${quesos}">
                        <input type="radio" name="queso" th:value="${queso.idTopping}"
                               required
                               th:checked="${quesoSeleccionado} == ${queso.idTopping}">
                        <span class="option__label">
                            <span th:text="${queso.nombre}">Queso</span>
                            <small class="option__price"
                                   th:text="${queso.precioTopping} == 0 ? 'incluido' : '$ ' + ${#numbers.formatDecimal(queso.precioTopping, 1, 2)}">
                                precio
                            </small>
                        </span>
                    </label>
                </div>
            </fieldset>

            <!-- TOPPINGS EXTRAS DESDE BD -->
            <!-- Toppings extras DESDE BD - CON CANTIDAD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Toppings extras</legend>
                <p class="form-hint">Seleccion√° los toppings extras. Pod√©s elegir la cantidad de cada uno.</p>

                <div class="toppings-grid">
                    <div class="topping-item" th:each="topping : ${toppingsExtras}">
                        <div class="topping-controls" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding: 0.5rem; border: 1px solid #e0e0e0; border-radius: 4px;">
                            <div>
                                <strong th:text="${topping.nombre}">Topping</strong>
                                <small class="option__price" th:text="' - $ ' + ${#numbers.formatDecimal(topping.precioTopping, 1, 2)}">$ 0</small>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label :for="'cantidad-topping-' + ${topping.idTopping}" class="form-label">Cantidad:</label>
                                <input type="number"
                                       :id="'cantidad-topping-' + ${topping.idTopping}"
                                       :name="'toppingsCantidad[' + ${topping.idTopping} + ']'"
                                       min="0" max="10"
                                       class="input input--number input--small"
                                       style="width: 80px;"
                                       th:value="${toppingsCantidad != null && toppingsCantidad[topping.idTopping] != null} ? ${toppingsCantidad[topping.idTopping]} : 0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen de toppings seleccionados -->
                <div th:if="${toppingsSeleccionadosResumen}" class="form-hint form-hint--total">
                    <span th:text="${toppingsSeleccionadosResumen}">Sin toppings extras ¬∑ $ 0</span>
                </div>
            </fieldset>
<!--            <fieldset class="form-section">-->
<!--                <legend class="form-section__title">Toppings extras</legend>-->
<!--                <p class="form-hint">Seleccion√° los que quieras (opcional).</p>-->
<!--                <p class="form-hint form-hint&#45;&#45;total"-->
<!--                   data-section-total="toppings"-->
<!--                   th:text="${toppingsLinea}">Sin toppings extras ¬∑ $ 0</p>-->

<!--                <div class="options options&#45;&#45;grid">-->
<!--                    <label class="option option&#45;&#45;checkbox" th:each="topping : ${toppingsExtras}">-->
<!--                        <input type="checkbox" name="toppingsExtras" th:value="${topping.idTopping}"-->
<!--                               th:checked="${toppingsExtrasSeleccionados != null and toppingsExtrasSeleccionados.contains(topping.idTopping)}">-->
<!--                        <span class="option__label">-->
<!--                            <span th:text="${topping.nombre}">Topping</span>-->
<!--                            <small class="option__price" th:text="'$ ' + ${#numbers.formatDecimal(topping.precioTopping, 1, 2)}">$ 0</small>-->
<!--                        </span>-->
<!--                    </label>-->
<!--                </div>-->
<!--            </fieldset>-->

            <!-- Cantidad + observaciones -->
            <fieldset class="form-section form-section--row">
                <div class="form-group">
                    <label for="cantidad">Cantidad</label>
                    <input type="number" id="cantidad" name="cantidad" min="1" step="1"
                           class="input input--number"
                           th:value="${cantidad != null} ? ${cantidad} : 1">
                </div>
                <div class="form-group form-group--grow">
                    <label for="observaciones">Observaciones (opcional)</label>
                    <textarea id="observaciones" name="observaciones" rows="2"
                              class="input input--textarea"
                              placeholder="Ej: sin picante, cortar en 8 porciones"
                              th:text="${observaciones}"></textarea>
                </div>
            </fieldset>

            <!-- Bot√≥n de favoritos -->
            <div class="favorites-box" style="text-align: right; margin-bottom: 1rem;">
                <button type="submit"
                        class="btn btn--secondary"
                        form="favForm"
                        th:formaction="@{/favoritos/agregar}"
                        formmethod="post">
                    ‚ù§Ô∏è Agregar a favoritos
                </button>
            </div>

            <!-- Resumen -->
            <section class="summary-box" aria-live="polite">
                <h2 class="summary-box__title">Resumen</h2>
                <ul class="summary-list">
                    <li><strong>Tama√±o:</strong> <span th:text="${tamanioResumen}">‚Äî</span></li>
                    <li><strong>Masa:</strong> <span th:text="${masaResumen}">‚Äî</span></li>
                    <li><strong>Salsa:</strong> <span th:text="${salsaResumen}">‚Äî</span></li>
                    <li><strong>Queso:</strong> <span th:text="${quesoResumen}">‚Äî</span></li>
                    <li><strong>Toppings extras:</strong> <span th:text="${toppingsExtrasResumen}">‚Äî</span></li>
                    <li><strong>Cantidad:</strong> <span th:text="${cantidad != null} ? ${cantidad} : 1">1</span></li>
                </ul>
                <div class="summary-total">
                    <span class="summary-total__label">Total estimado</span>
                    <span class="summary-total__value" th:text="${totalEstimado}">$ ‚Äî</span>
                </div>
            </section>

            <!-- Acciones -->
            <div class="form-actions">
                <button type="submit" class="btn btn--secondary" name="accion" value="actualizar">
                    Actualizar resumen
                </button>
                <button type="submit" class="btn btn--primary" name="accion" value="agregar">
                    Agregar al carrito
                </button>
                <a class="btn btn--ghost" th:href="@{/carrito}">Ver carrito</a>
                <a class="btn btn--link" th:href="@{/}">Volver al inicio</a>
            </div>
        </form>
    </section>
</main>

<footer class="site-footer">
    <div class="container footer__inner">
        <small>&copy; 2025 PizzUM &amp; BurgUM</small>
        <nav class="footer-nav">
            <a th:href="@{#}" class="footer__link">Ayuda</a>
            <a th:href="@{#}" class="footer__link">T√©rminos</a>
            <a th:href="@{#}" class="footer__link">Privacidad</a>
        </nav>
    </div>
</footer>

</body>
</html>