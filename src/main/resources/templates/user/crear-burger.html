<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PizzUM & BurgUM ‚Äî Crear hamburguesa</title>

    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/pages.css}">
</head>
<body class="theme-italian">
<header class="site-header">
    <div class="container header__inner">
        <div class="header-left">
            <a class="brand" th:href="@{/}">
                <img th:src="@{/img/logo.png}" alt="PizzUM &amp; BurgUM" class="brand__logo">
                <span class="brand__name">PizzUM &amp; BurgUM</span>
            </a>
        </div>

        <nav class="site-nav" th:if="${session.cliente != null}">
            <a class="nav__link" th:href="@{/crear-pizza}">Crear pizza</a>
            <a class="nav__link" th:href="@{/crear-burger}">Crear hamburguesa</a>
            <a class="nav__link" th:href="@{/carrito}">Carrito</a>
            <a class="nav__link" th:href="@{/pedido}">Pedidos</a>
        </nav>

        <div class="header-right">
            <div th:if="${session.cliente != null}" class="user-info">
                <span>Hola, <strong th:text="${session.clienteNombre}">Usuario</strong></span>
                <form th:action="@{/logout}" method="post" class="logout-form">
                    <button type="submit" class="btn btn--link">Cerrar Sesi√≥n</button>
                </form>
            </div>

            <div th:unless="${session.cliente != null}" class="auth-buttons">
                <a th:href="@{/login}" class="btn btn--primary">Iniciar Sesi√≥n</a>
                <a th:href="@{/register}" class="btn btn--secondary">Registrarse</a>
            </div>
        </div>
    </div>
</header>

<main>
    <section class="page-hero">
        <div class="container page-hero__inner">
            <div class="page-hero__media">
                <img th:src="@{/img/custom-burger.png}" alt="Ingredientes frescos para tu hamburguesa" class="page-hero__img">
            </div>
            <div class="page-hero__content">
                <h1>Cre√° tu hamburguesa üçî</h1>
                <p>Eleg√≠ la cantidad de carnes (1 a 3), tipo de carne, pan, aderezos y extras. Agregala al carrito.</p>
            </div>
        </div>
    </section>

    <section class="container section">
        <form class="form form--builder" method="post" th:action="@{/crear-burger}">
            <!-- Cantidad de carnes -->
            <fieldset class="form-section">
                <legend class="form-section__title">Cantidad de carnes</legend>
                <div class="options options--inline">
                    <label class="option">
                        <input type="radio" name="cantidad_carnes" id="carnes-1" value="1" required
                               th:checked="${cantidadCarnesSeleccionada != null && cantidadCarnesSeleccionada == 1}">
                        <span class="option__label">1 carne</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="cantidad_carnes" id="carnes-2" value="2"
                               th:checked="${cantidadCarnesSeleccionada != null && cantidadCarnesSeleccionada == 2}">
                        <span class="option__label">2 carnes</span>
                    </label>
                    <label class="option">
                        <input type="radio" name="cantidad_carnes" id="carnes-3" value="3"
                               th:checked="${cantidadCarnesSeleccionada != null && cantidadCarnesSeleccionada == 3}">
                        <span class="option__label">3 carnes</span>
                    </label>
                </div>
            </fieldset>

            <!-- Tipo de carne DESDE BD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Tipo de carne</legend>
                <div class="options options--inline">
                    <label class="option" th:each="carne : ${carnes}">
                        <input type="radio" name="tipo_carne" th:value="${carne.idTopping}" required
                               th:checked="${carneSeleccionada != null && carneSeleccionada == carne.idTopping}">
                        <span class="option__label">
                <span th:text="${carne.nombre}">Carne</span>
                <small class="option__price"
                       th:text="${carne.precioTopping} == 0 ? 'incluido' : '$ ' + ${#numbers.formatDecimal(carne.precioTopping, 1, 2)}">
                  precio
                </small>
              </span>
                    </label>
                </div>
            </fieldset>

            <!-- Tipo de pan DESDE BD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Tipo de pan</legend>
                <div class="options options--inline">
                    <label class="option" th:each="pan : ${panes}">
                        <input type="radio" name="tipo_pan" th:value="${pan.idTopping}" required
                               th:checked="${panSeleccionado != null && panSeleccionado == pan.idTopping}">
                        <span class="option__label">
                <span th:text="${pan.nombre}">Pan</span>
                <small class="option__price"
                       th:text="${pan.precioTopping} == 0 ? 'incluido' : '$ ' + ${#numbers.formatDecimal(pan.precioTopping, 1, 2)}">
                  precio
                </small>
              </span>
                    </label>
                </div>
            </fieldset>

            <!-- Aderezos DESDE BD - CON CANTIDAD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Aderezos</legend>
                <p class="form-hint">Seleccion√° los aderezos. Pod√©s elegir la cantidad de cada uno.</p>

                <div class="aderezos-grid">
                    <div class="aderezo-item" th:each="aderezo : ${aderezos}">
                        <div class="aderezo-controls" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding: 0.5rem; border: 1px solid #e0e0e0; border-radius: 4px;">
                            <div>
                                <strong th:text="${aderezo.nombre}">Aderezo</strong>
                                <small class="option__price" th:text="' - $ ' + ${#numbers.formatDecimal(aderezo.precio, 1, 2)}">$ 0</small>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label :for="'cantidad-aderezo-' + ${aderezo.idAderezo}" class="form-label">Cantidad:</label>
                                <input type="number"
                                       :id="'cantidad-aderezo-' + ${aderezo.idAderezo}"
                                       :name="'aderezosCantidad[' + ${aderezo.idAderezo} + ']'"
                                       min="0" max="10"
                                       class="input input--number input--small"
                                       style="width: 80px;"
                                       th:value="${aderezosCantidad != null && aderezosCantidad[aderezo.idAderezo] != null} ? ${aderezosCantidad[aderezo.idAderezo]} : 0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen de aderezos seleccionados -->
                <div th:if="${aderezosSeleccionadosResumen}" class="form-hint form-hint--total">
                    <span th:text="${aderezosSeleccionadosResumen}">Sin aderezos ¬∑ $ 0</span>
                </div>
            </fieldset>

            <!-- Extras DESDE BD - CON CANTIDAD -->
            <fieldset class="form-section">
                <legend class="form-section__title">Extras</legend>
                <p class="form-hint">Seleccion√° los extras. Pod√©s elegir la cantidad de cada uno.</p>

                <div class="extras-grid">
                    <div class="extra-item" th:each="extra : ${extras}">
                        <div class="extra-controls" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; padding: 0.5rem; border: 1px solid #e0e0e0; border-radius: 4px;">
                            <div>
                                <strong th:text="${extra.nombre}">Extra</strong>
                                <small class="option__price" th:text="' - $ ' + ${#numbers.formatDecimal(extra.precioTopping, 1, 2)}">$ 0</small>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label :for="'cantidad-extra-' + ${extra.idTopping}" class="form-label">Cantidad:</label>
                                <input type="number"
                                       :id="'cantidad-extra-' + ${extra.idTopping}"
                                       :name="'extrasCantidad[' + ${extra.idTopping} + ']'"
                                       min="0" max="10"
                                       class="input input--number input--small"
                                       style="width: 80px;"
                                       th:value="${extrasCantidad != null && extrasCantidad[extra.idTopping] != null} ? ${extrasCantidad[extra.idTopping]} : 0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen de extras seleccionados -->
                <div th:if="${extrasSeleccionadosResumen}" class="form-hint form-hint--total">
                    <span th:text="${extrasSeleccionadosResumen}">Sin extras ¬∑ $ 0</span>
                </div>
            </fieldset>

            <!-- Cantidad + observaciones -->
            <fieldset class="form-section form-section--row">
                <div class="form-group">
                    <label for="cantidad">Cantidad</label>
                    <input type="number" id="cantidad" name="cantidad" min="1" step="1"
                           class="input input--number" th:value="${cantidad}">
                </div>
                <div class="form-group form-group--grow">
                    <label for="observaciones">Observaciones (opcional)</label>
                    <textarea id="observaciones" name="observaciones" rows="2" class="input input--textarea"
                              placeholder="Ej: sin pepinillos, con mucho ketchup"
                              th:text="${observaciones}"></textarea>
                </div>
            </fieldset>

            <!-- Resumen -->
            <section class="summary-box" aria-live="polite">
                <h2 class="summary-box__title">Resumen</h2>
                <ul class="summary-list">
                    <li><strong>Cant. carnes:</strong> <span th:text="${cantidadCarnesResumen}">‚Äî</span></li>
                    <li><strong>Tipo de carne:</strong> <span th:text="${carneResumen}">‚Äî</span></li>
                    <li><strong>Pan:</strong> <span th:text="${panResumen}">‚Äî</span></li>
                    <li><strong>Aderezos:</strong> <span th:text="${aderezosResumen}">‚Äî</span></li>
                    <li><strong>Extras:</strong> <span th:text="${extrasResumen}">‚Äî</span></li>
                    <li><strong>Cantidad:</strong> <span th:text="${cantidad}">1</span></li>
                </ul>
                <div class="summary-total">
                    <span class="summary-total__label">Total estimado</span>
                    <span class="summary-total__value" th:text="${totalEstimado}">$ ‚Äî</span>
                </div>
            </section>

            <!-- Acciones -->
            <div class="form-actions">
                <button type="submit" class="btn btn--secondary" name="accion" value="actualizar"
                        formaction="@{/crear-burger}" formmethod="get">
                    Actualizar resumen
                </button>
                <button type="submit" class="btn btn--primary" name="accion" value="agregar">
                    Agregar al carrito
                </button>
                <a class="btn btn--ghost" th:href="@{/carrito}">Ver carrito</a>
                <a class="btn btn--link" th:href="@{/}">Volver al inicio</a>
            </div>
        </form>
    </section>
</main>

<footer class="site-footer">
    <div class="container footer__inner">
        <small>&copy; 2025 PizzUM &amp; BurgUM</small>
        <nav class="footer-nav">
            <a th:href="@{#}" class="footer__link">Ayuda</a>
            <a th:href="@{#}" class="footer__link">T√©rminos</a>
            <a th:href="@{#}" class="footer__link">Privacidad</a>
        </nav>
    </div>
</footer>
</body>
</html>